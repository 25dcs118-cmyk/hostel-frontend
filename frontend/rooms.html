<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rooms</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<nav>
  <div class="nav-left">
    <h2>Rooms</h2>
  </div>

  <div class="navbar-hostel-info">
    <p><strong>Premium Boys Hostel</strong></p>
  </div>

  <button class="btn-secondary" onclick="goDashboard()">Back</button>
</nav>

<section class="grid">

  <!-- ADMIN: ADD ROOM -->
  <div class="card" id="adminRoomForm">
    <h3>â• Add Room</h3>
    <input id="roomNumber" placeholder="Room Number">
    <input id="capacity" placeholder="Capacity">
    <button onclick="addRoom()">Add Room</button>
  </div>

  <!-- ROOMS LIST -->
  <div class="card">
    <h3>ğŸ  Available Rooms</h3>
    <ul id="roomsList"></ul>
  </div>

  <!-- TENANT: BOOK ROOM -->
  <div class="card" id="bookingCard">
    <h3>ğŸ“Œ Book Room</h3>
    <select id="selectRoom"></select>
    <button onclick="bookRoom()">Book</button>
  </div>

</section>

<script src="js/auth.js"></script>
<script src="js/api.js"></script>

<script>
  requireAuth();
  const session = JSON.parse(localStorage.getItem("session"));

  function goDashboard() {
    window.location.replace("dashboard.html");
  }

  history.pushState(null, null, location.href);
  window.onpopstate = () => goDashboard();

  // Role-based UI
  if (session.role !== "admin") {
    document.getElementById("adminRoomForm").style.display = "none";
  }

  async function loadRooms() {
    const rooms = await getAll("rooms");
    const list = document.getElementById("roomsList");
    const select = document.getElementById("selectRoom");

    list.innerHTML = "";
    select.innerHTML = "";

    rooms.forEach(r => {
      const li = document.createElement("li");
      li.innerText = `Room ${r.number} | Capacity: ${r.capacity} | ${r.booked ? "Booked" : "Available"}`;
      list.appendChild(li);

      if (!r.booked) {
        const opt = document.createElement("option");
        opt.value = r._id;
        opt.innerText = `Room ${r.number}`;
        select.appendChild(opt);
      }
    });
  }

  window.onload = loadRooms;
</script>

</body>
</html>
