<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Notices</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<nav>
  <h2>Notice Board</h2>
  <button class="btn-secondary" onclick="goDashboard()">Back</button>
</nav>

<section class="grid">

  <!-- ADMIN: ADD NOTICE -->
  <div class="card" id="adminNoticeForm">
    <h3>ðŸ“¢ Post Notice</h3>
    <input id="title" placeholder="Title">
    <textarea id="content" placeholder="Notice content..."></textarea>
    <button onclick="addNotice()">Post</button>
  </div>

  <!-- NOTICES LIST -->
  <div class="card">
    <h3>ðŸ“„ Notices</h3>
    <ul id="noticeList"></ul>
  </div>

</section>

<script src="js/auth.js"></script>
<script src="js/api.js"></script>

<script>
  requireAuth();
  const session = JSON.parse(localStorage.getItem("session"));

  function goDashboard() {
    window.location.replace("dashboard.html");
  }

  history.pushState(null, null, location.href);
  window.onpopstate = () => goDashboard();

  // Role-based UI
  if (session.role !== "admin") {
    document.getElementById("adminNoticeForm").style.display = "none";
  }

  async function loadNotices() {
    const notices = await getAll("notices");
    const list = document.getElementById("noticeList");
    list.innerHTML = "";

    notices.forEach(n => {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${n.title}</strong><br>
        ${n.content}<br>
        <small>${new Date(n.createdAt || Date.now()).toLocaleString()}</small>
      `;
      list.appendChild(li);
    });
  }

  window.onload = loadNotices;
</script>

</body>
</html>
