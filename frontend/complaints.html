<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Complaints</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body>

<nav>
  <h2>Complaints</h2>
  <button class="btn-secondary" onclick="goDashboard()">Back</button>
</nav>

<section class="grid">

  <!-- TENANT: ADD COMPLAINT -->
  <div class="card" id="tenantComplaintForm">
    <h3>ğŸ“ Raise Complaint</h3>
    <input id="subject" placeholder="Subject">
    <textarea id="description" placeholder="Describe your issue..."></textarea>
    <button onclick="addComplaint()">Submit</button>
  </div>

  <!-- COMPLAINTS LIST -->
  <div class="card">
    <h3>ğŸ“‹ Complaints</h3>
    <ul id="complaintList"></ul>
  </div>

</section>

<script src="js/auth.js"></script>
<script src="js/api.js"></script>

<script>
  requireAuth();
  const session = JSON.parse(localStorage.getItem("session"));

  function goDashboard() {
    window.location.replace("dashboard.html");
  }

  history.pushState(null, null, location.href);
  window.onpopstate = () => goDashboard();

  // Role-based UI
  if (session.role !== "tenant") {
    document.getElementById("tenantComplaintForm").style.display = "none";
  }

  async function loadComplaints() {
    const complaints = await getAll("complaints");
    const list = document.getElementById("complaintList");
    list.innerHTML = "";

    complaints.forEach(c => {
      const li = document.createElement("li");
      li.innerHTML = `
        <strong>${c.subject}</strong><br>
        ${c.description}<br>
        <small>Status: ${c.status || "Pending"}</small>
      `;
      list.appendChild(li);
    });
  }

  window.onload = loadComplaints;
</script>

</body>
</html>
